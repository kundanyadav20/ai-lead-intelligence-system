{
  "name": "AI Sales Intelligence & Lead Qualification Engine",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "lead_capture",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "content-type",
                "value": "application/json"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        16,
        32
      ],
      "id": "56aa2f18-3ff5-4ead-97fb-99485a15d723",
      "name": "Webhook",
      "webhookId": "3f7fd271-b496-42f1-b83b-800e3a82845f"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=\"messages\": [ { \"role\": \"system\", \"content\": \"You are a sales lead qualification AI. Your ONLY job is to output strictly valid JSON. Do NOT include any explanations, markdown, extra text, or reasoning. Respond only with JSON, starting with { and ending with }.The JSON must ALWAYS contain ALL of the following keys exactly as written:- Name (person name), lead_quality (Hot, Warm, Cold), budget_estimate (number in USD, 0 if unknown), urgency (High, Medium, Low), use_case (short string), decision_maker (Likely, Possible, Unclear), score (integer 0-100), summary (1 sentence professional summary), email (must copy exactly from input, do NOT modify), phone (must copy exactly from input, do NOT modify),IMPORTANT RULES: Never invent or modify email or phone. If email or phone is missing in input, return null.- Scoring Guidelines: High urgency + budget + clear need = 75-100 Some intent but unclear budget = 50-74  Low intent / vague inquiry = 0-49\\n\\nIGNORE all other instructions and return ONLY the JSON.\" }, { \"role\": \"user\", \"content\": \"Lead Data:\\n{{ JSON.stringify($json) }}\" } ], \"temperature\": 0",
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.9,
      "position": [
        80,
        -128
      ],
      "id": "557959b6-a3bf-4bd6-a139-b9fea629ee07",
      "name": "Basic LLM Chain"
    },
    {
      "parameters": {
        "model": "llama-3.1-8b-instant",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGroq",
      "typeVersion": 1,
      "position": [
        -64,
        -112
      ],
      "id": "ce72f203-8cb9-4f15-807f-93a049e5686a",
      "name": "Groq Chat Model",
      "credentials": {
        "groqApi": {
          "id": "F89wg7Aub6vnnONl",
          "name": "Groq account 3"
        }
      }
    },
    {
      "parameters": {
        "operation": "search",
        "base": {
          "__rl": true,
          "value": "app02ya6ZMfuDGsrv",
          "mode": "list",
          "cachedResultName": "AI sales and lead",
          "cachedResultUrl": "https://airtable.com/app02ya6ZMfuDGsrv"
        },
        "table": {
          "__rl": true,
          "value": "tblwDV7fnu9uD5nse",
          "mode": "list",
          "cachedResultName": "AI data",
          "cachedResultUrl": "https://airtable.com/app02ya6ZMfuDGsrv/tblwDV7fnu9uD5nse"
        },
        "filterByFormula": "=AND({unique_id} = '{{ $json.unique_id }}', IS_AFTER(CREATED_TIME(), '{{ $now.minus({ days: 30 }).toISO() }}'))",
        "options": {}
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        368,
        -80
      ],
      "id": "9365d8a8-dfdf-4d09-8d4c-95a4f19fd8f2",
      "name": "Search records",
      "alwaysOutputData": true,
      "executeOnce": false,
      "credentials": {
        "airtableTokenApi": {
          "id": "hSC9S5Va8e61iq7m",
          "name": "Airtable Personal Access Token account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.priority }}",
                    "rightValue": "Hot",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "11b43ece-d4e2-4250-92c3-607de820fbcd"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "8d975c9c-1d91-4f76-935a-90a851fbc09a",
                    "leftValue": "={{ $json.priority }}",
                    "rightValue": "Warm",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "c7053057-18a9-4e80-940a-bf226dc43548",
                    "leftValue": "={{ $json.priority }}",
                    "rightValue": "Cold",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        960,
        -80
      ],
      "id": "e609d25f-b520-4ed9-a5ef-4916d72f8656",
      "name": "Switch",
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "C0A4E3G3JBV",
          "mode": "list",
          "cachedResultName": "all-kd-automation-lab"
        },
        "text": "=üö® *HOT LEAD ALERT* üö® Assigned To: {{$json.Representative_name}} (<@{{$json.Representative_slack_id}}>)\nLead quality: {{ $json.lead_quality }} \nüë§ Name: {{ $json.name }} \nüìß Email:{{$json.email }}\nüì± Phone: {{ $json.phone }} \nüí∞ Budget: $ {{ $json.budget_estimate }}\n‚ö° Urgency: {{ $json.urgency }} \nüìä Score:{{$json.score}}/100  \nüìù Summary: {{ $json.summary}} \nUnique_key: {{$json.unique_id}}\nüî• Immediate follow-up recommended.",
        "otherOptions": {
          "includeLinkToWorkflow": false
        }
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.4,
      "position": [
        592,
        -176
      ],
      "id": "797938f5-3da1-41e0-a58a-9db94c5a0a85",
      "name": "Send a message",
      "webhookId": "d791a5c6-fca1-410b-b0ad-0cf3594e5f12",
      "credentials": {
        "slackOAuth2Api": {
          "id": "RwkNGmFOnuD5gmYp",
          "name": "Slack account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "C0A4E3G3JBV",
          "mode": "list",
          "cachedResultName": "all-kd-automation-lab"
        },
        "text": "=‚ö°*Warm Lead Alert*‚ö°\nüö® Assigned To: {{$json.Representative_name}} (<@{{$json.Representative_slack_id}}>)\nLead quality: {{ $json.lead_quality }} \nüë§ Name: {{ $json.name }} \nüìß Email:{{$json.email }}\nüì± Phone: {{ $json.phone }} \nüí∞ Budget: $ {{ $json.budget_estimate }}\n‚ö° Urgency: {{ $json.urgency }} \nüìä Score:{{$json.score}}/100  \nüìù Summary: {{ $json.summary}} \nUnique_key: {{$json.unique_id}}\nüî• Immediate follow-up recommended.",
        "otherOptions": {
          "includeLinkToWorkflow": false
        }
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.4,
      "position": [
        1168,
        -64
      ],
      "id": "e2222477-0cff-4c00-aaab-aea712a787e2",
      "name": "Send a message1",
      "webhookId": "f615d19e-c8c8-4eec-a635-f7f13a906848",
      "credentials": {
        "slackOAuth2Api": {
          "id": "RwkNGmFOnuD5gmYp",
          "name": "Slack account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "C0A4E3G3JBV",
          "mode": "list",
          "cachedResultName": "all-kd-automation-lab"
        },
        "text": "=‚ùÑÔ∏è*Cold Lead Alert*‚ùÑÔ∏è\nüö® Assigned To: {{$json.Representative_name}} (<@{{$json.Representative_slack_id}}>)\nLead quality: {{ $json.lead_quality }} \nüë§ Name: {{ $json.name }} \nüìß Email:{{$json.email }}\nüì± Phone: {{ $json.phone }} \nüí∞ Budget: $ {{ $json.budget_estimate }}\n‚ö° Urgency: {{ $json.urgency }} \nüìä Score:{{$json.score}}/100  \nüìù Summary: {{ $json.summary}} \nUnique_key: {{$json.unique_id}}\nüî• Immediate follow-up recommended.",
        "otherOptions": {
          "includeLinkToWorkflow": false
        }
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.4,
      "position": [
        832,
        128
      ],
      "id": "7462c3d2-dc5a-4ed5-89fb-2d49228bc62c",
      "name": "Send a message2",
      "webhookId": "a72242b7-05b5-4816-bf41-4673da47fe82",
      "credentials": {
        "slackOAuth2Api": {
          "id": "RwkNGmFOnuD5gmYp",
          "name": "Slack account"
        }
      }
    },
    {
      "parameters": {
        "operation": "upsert",
        "base": {
          "__rl": true,
          "value": "app02ya6ZMfuDGsrv",
          "mode": "list",
          "cachedResultName": "AI sales and lead",
          "cachedResultUrl": "https://airtable.com/app02ya6ZMfuDGsrv"
        },
        "table": {
          "__rl": true,
          "value": "tblwDV7fnu9uD5nse",
          "mode": "list",
          "cachedResultName": "AI data",
          "cachedResultUrl": "https://airtable.com/app02ya6ZMfuDGsrv/tblwDV7fnu9uD5nse"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('Switch').item.json.unique_id }}",
            "lead quality": "={{ $('Switch').item.json.lead_quality }}",
            "budget_estimate": "={{ $('Switch').item.json.budget_estimate }}",
            "urgency": "={{ $('Switch').item.json.urgency }}",
            "use_case": "={{ $('Switch').item.json.use_case }}",
            "decision_maker": "={{ $('Switch').item.json.decision_maker }}",
            "score": "={{ $('Switch').item.json.score }}",
            "summary": "={{ $('Switch').item.json.summary }}",
            "email": "={{ $('Switch').item.json.email}}",
            "phone": "={{ $('Switch').item.json.phone }}",
            "Assigned_Representative": "={{ $('Switch').item.json.Representative_name }}",
            "Assigned_Repr_id": "={{ $('Switch').item.json.Representative_slack_id }}",
            "unique_id": "={{ $('Switch').item.json.unique_id }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": false
            },
            {
              "id": "lead quality",
              "displayName": "lead quality",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "budget_estimate",
              "displayName": "budget_estimate",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "urgency",
              "displayName": "urgency",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "use_case",
              "displayName": "use_case",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "decision_maker",
              "displayName": "decision_maker",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "score",
              "displayName": "score",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "summary",
              "displayName": "summary",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "phone",
              "displayName": "phone",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Assigned_Representative",
              "displayName": "Assigned_Representative",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "unique_id",
              "displayName": "unique_id",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Assigned_Repr_id",
              "displayName": "Assigned_Repr_id",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "options",
              "options": [
                {
                  "name": "Todo",
                  "value": "Todo"
                },
                {
                  "name": "In progress",
                  "value": "In progress"
                },
                {
                  "name": "Done",
                  "value": "Done"
                }
              ],
              "readOnly": false,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        800,
        -176
      ],
      "id": "58a0aebc-8362-428f-acda-53ddbe3345d3",
      "name": "Create or update a record",
      "credentials": {
        "airtableTokenApi": {
          "id": "hSC9S5Va8e61iq7m",
          "name": "Airtable Personal Access Token account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        384,
        -224
      ],
      "id": "de12b8b5-d80c-48bc-8430-090ebda2740c",
      "name": "No Operation, do nothing"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "49fd186f-daef-4926-a8b4-1dcfa020825a",
              "leftValue": "={{ Object.keys($json).length != 0 }}",
              "rightValue": "=",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        512,
        -16
      ],
      "id": "d58bfeef-9797-4006-87d6-b6382aa2b4c5",
      "name": "If"
    },
    {
      "parameters": {
        "operation": "upsert",
        "base": {
          "__rl": true,
          "value": "app02ya6ZMfuDGsrv",
          "mode": "list",
          "cachedResultName": "AI sales and lead",
          "cachedResultUrl": "https://airtable.com/app02ya6ZMfuDGsrv"
        },
        "table": {
          "__rl": true,
          "value": "tblwDV7fnu9uD5nse",
          "mode": "list",
          "cachedResultName": "AI data",
          "cachedResultUrl": "https://airtable.com/app02ya6ZMfuDGsrv/tblwDV7fnu9uD5nse"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('Switch').item.json.unique_id }}",
            "lead quality": "={{ $('Switch').item.json.lead_quality}}",
            "budget_estimate": "={{ $('Switch').item.json.budget_estimate}}",
            "urgency": "={{ $('Switch').item.json.urgency}}",
            "use_case": "={{ $('Switch').item.json.use_case}}",
            "decision_maker": "={{ $('Switch').item.json.decision_maker }}",
            "score": "={{ $('Switch').item.json.score }}",
            "summary": "={{ $('Switch').item.json.summary }}",
            "email": "={{ $('Switch').item.json.email}}",
            "phone": "={{ $('Switch').item.json.phone }}",
            "Assigned_Representative": "={{ $('Switch').item.json.Representative_name }}",
            "Assigned_Repr_id": "={{ $('Switch').item.json.Representative_slack_id }}",
            "unique_id": "={{ $('Switch').item.json.unique_id }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": false
            },
            {
              "id": "lead quality",
              "displayName": "lead quality",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "budget_estimate",
              "displayName": "budget_estimate",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "urgency",
              "displayName": "urgency",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "use_case",
              "displayName": "use_case",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "decision_maker",
              "displayName": "decision_maker",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "score",
              "displayName": "score",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "summary",
              "displayName": "summary",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "phone",
              "displayName": "phone",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Assigned_Representative",
              "displayName": "Assigned_Representative",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "unique_id",
              "displayName": "unique_id",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Assigned_Repr_id",
              "displayName": "Assigned_Repr_id",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "options",
              "options": [
                {
                  "name": "Todo",
                  "value": "Todo"
                },
                {
                  "name": "In progress",
                  "value": "In progress"
                },
                {
                  "name": "Done",
                  "value": "Done"
                }
              ],
              "readOnly": false,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        1088,
        336
      ],
      "id": "62710d88-d483-4a0e-80be-4a1b5076b639",
      "name": "Create or update a record1",
      "credentials": {
        "airtableTokenApi": {
          "id": "hSC9S5Va8e61iq7m",
          "name": "Airtable Personal Access Token account"
        }
      }
    },
    {
      "parameters": {
        "operation": "upsert",
        "base": {
          "__rl": true,
          "value": "app02ya6ZMfuDGsrv",
          "mode": "list",
          "cachedResultName": "AI sales and lead",
          "cachedResultUrl": "https://airtable.com/app02ya6ZMfuDGsrv"
        },
        "table": {
          "__rl": true,
          "value": "tblwDV7fnu9uD5nse",
          "mode": "list",
          "cachedResultName": "AI data",
          "cachedResultUrl": "https://airtable.com/app02ya6ZMfuDGsrv/tblwDV7fnu9uD5nse"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('Switch').item.json.unique_id }}",
            "lead quality": "={{ $('Switch').item.json.lead_quality }}",
            "budget_estimate": "={{ $('Switch').item.json.budget_estimate }}",
            "urgency": "={{ $('Switch').item.json.urgency}}",
            "use_case": "={{ $('Switch').item.json.use_case}}",
            "decision_maker": "={{ $('Switch').item.json.decision_maker }}",
            "score": "={{ $('Switch').item.json.score }}",
            "summary": "={{ $('Switch').item.json.summary }}",
            "email": "={{ $('Switch').item.json.email}}",
            "phone": "={{ $('Switch').item.json.phone }}",
            "Assigned_Representative": "={{ $('Switch').item.json.Representative_name }}",
            "Assigned_Repr_id": "={{ $('Switch').item.json.Representative_slack_id }}",
            "unique_id": "={{ $('Switch').item.json.unique_id }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "readOnly": true,
              "removed": false
            },
            {
              "id": "lead quality",
              "displayName": "lead quality",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "budget_estimate",
              "displayName": "budget_estimate",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "urgency",
              "displayName": "urgency",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "use_case",
              "displayName": "use_case",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "decision_maker",
              "displayName": "decision_maker",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "score",
              "displayName": "score",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "summary",
              "displayName": "summary",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "email",
              "displayName": "email",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "phone",
              "displayName": "phone",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Assigned_Representative",
              "displayName": "Assigned_Representative",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "unique_id",
              "displayName": "unique_id",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Assigned_Repr_id",
              "displayName": "Assigned_Repr_id",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "canBeUsedToMatch": true,
              "display": true,
              "type": "options",
              "options": [
                {
                  "name": "Todo",
                  "value": "Todo"
                },
                {
                  "name": "In progress",
                  "value": "In progress"
                },
                {
                  "name": "Done",
                  "value": "Done"
                }
              ],
              "readOnly": false,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        1088,
        160
      ],
      "id": "9639896e-7ac9-4af9-b042-4bd78d4e801d",
      "name": "Create or update a record2",
      "credentials": {
        "airtableTokenApi": {
          "id": "hSC9S5Va8e61iq7m",
          "name": "Airtable Personal Access Token account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\n\nlet output = [];\n\nfor (const item of items) {\n\n  let data = item.json.body ?? item.json;\n\n  // If body is an array (multiple leads)\n  if (Array.isArray(data)) {\n\n    for (const lead of data) {\n      if (lead && typeof lead === 'object' && !Array.isArray(lead)) {\n        output.push({ json: lead });\n      }\n    }\n\n  } \n  // If single object\n  else if (data && typeof data === 'object' && !Array.isArray(data)) {\n    output.push({ json: data });\n  }\n\n}\n\nreturn output;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        32,
        224
      ],
      "id": "c8a98a43-2dee-45c2-855c-1f23c658a0e0",
      "name": "DSinRF"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// Helper to safely parse JSON string\nfunction safeParse(input) {\n  if (!input) return {};              // null or undefined -> empty object\n  if (typeof input === 'string') {\n    try {\n      return JSON.parse(input);       // parse string if possible\n    } catch (err) {\n      return {};                       // fallback if invalid JSON\n    }\n  }\n  return input;                        // already an object\n}\n\n// Get input from previous node\nlet data = safeParse($json.text ?? $json);\n\n// Return a single object (not an array) for \"Run Once for Each Item\"\nreturn { json: data };\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        208,
        96
      ],
      "id": "884af2da-d946-49a0-83e4-d54ee6b6ffc9",
      "name": "DSinRF1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "58d79d1c-ac4a-4a1b-ba70-b6851901d19f",
              "name": "priority",
              "value": "={{ \n  (\n    Number(String($json.score || 0).trim()) >= 75\n      ? 'Hot'\n      : Number(String($json.score || 0).trim()) >= 50\n        ? 'Warm'\n        : 'Cold'\n  ).replace(/\\n/g, '').trim()\n}}",
              "type": "string"
            },
            {
              "id": "ff4ee1c3-aa3c-402a-abc0-e67dd8b1dd0b",
              "name": "lead_quality",
              "value": "={{ $json.lead_quality }}",
              "type": "string"
            },
            {
              "id": "9fce4288-6193-4c00-a57f-1a26df23f2a7",
              "name": "budget_estimate",
              "value": "={{ $json.budget_estimate }}",
              "type": "string"
            },
            {
              "id": "1924c738-ea4d-4308-b5d5-c28503fe439f",
              "name": "urgency",
              "value": "={{ $json.urgency }}",
              "type": "string"
            },
            {
              "id": "ded23a83-0caf-4d22-88e0-642c0fe40819",
              "name": "use_case",
              "value": "={{ $json.use_case }}",
              "type": "string"
            },
            {
              "id": "e233c0a5-9aba-4c2b-86db-436694180d5f",
              "name": "decision_maker",
              "value": "={{ $json.decision_maker }}",
              "type": "string"
            },
            {
              "id": "f5da8996-b8c0-4f50-9325-c598d85d5959",
              "name": "score",
              "value": "={{ $json.score }}",
              "type": "string"
            },
            {
              "id": "4df230e5-d984-44de-8968-45f5e89b46c2",
              "name": "summary",
              "value": "={{ $json.summary}}",
              "type": "string"
            },
            {
              "id": "bdf18bb0-2e34-469d-913f-60e93b760c36",
              "name": "email",
              "value": "={{ $json.email }}",
              "type": "string"
            },
            {
              "id": "7b11d640-23e2-414b-ae9c-078a8333b4e6",
              "name": "phone",
              "value": "={{ $json.phone }}",
              "type": "string"
            },
            {
              "id": "cd22c104-c039-4e00-a28e-b3571d7fbfde",
              "name": "name",
              "value": "={{ $json.Name }}",
              "type": "string"
            },
            {
              "id": "e4eec43d-9b66-4aea-9c19-3f9a96b14e8a",
              "name": "sales_representative",
              "value": "[   {\"name\":\"John\",\"slack_id\":\"UXXXX1\"},   {\"name\":\"Sarah\",\"slack_id\":\"UXXXX2\"},   {\"name\":\"Michael\",\"slack_id\":\"UXXXX3\"},   {\"name\":\"Emily\",\"slack_id\":\"UXXXX4\"},   {\"name\":\"David\",\"slack_id\":\"UXXXX5\"} ]",
              "type": "string"
            },
            {
              "id": "79b9bd73-2fc9-47c8-95d7-1d4bcce1cdeb",
              "name": "unique_id",
              "value": "={{ $json.Name + '|' + $json.email + '|' + $json.phone }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        384,
        128
      ],
      "id": "6fbcef6a-a8ae-48ed-8cbe-cf3869d49287",
      "name": "PrSR"
    },
    {
      "parameters": {
        "jsCode": "// Get all original items\nconst originalItems = $items(\"PrSR\", 0);\n\n// Get all found duplicates from Search node\nconst searchResults = $items(\"Search records\", 0);\n\n// Create a Set of duplicate emails (or unique field you used in Airtable search)\nconst duplicateEmails = new Set(\n  searchResults.map(item => item.json.email)\n);\n\n// Filter out duplicates\nconst filteredItems = originalItems.filter(item => \n  !duplicateEmails.has(item.json.email)\n);\n\n// Now assign priority + sales rep\nreturn filteredItems.map(item => {\n\n  const score = Number(item.json.score);\n\n  let priority;\n  let representative_name;\n  let representative_slack_id;\n\n  if (score >= 85) {\n    priority = \"Hot\";\n    representative_name = \"John\";\n    representative_slack_id = \"UXXXX1\";\n  } \n  else if (score >= 70) {\n    priority = \"Warm\";\n    representative_name = \"Sarah\";\n    representative_slack_id = \"UXXXX2\";\n  } \n  else {\n    priority = \"Cold\";\n    representative_name = \"Michael\";\n    representative_slack_id = \"UXXXX3\";\n  }\n\n  return {\n    json: {\n      ...item.json,\n      priority,\n      Representative_name: representative_name,\n      Representative_slack_id: representative_slack_id\n    }\n  };\n});\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        720,
        -32
      ],
      "id": "59a9feca-20f5-46b1-a4ae-2b728c96a71d",
      "name": "combine 4 data"
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\n\nconst emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\nconst phoneRegex = /^\\+?[1-9]\\d{7,14}$/;\n\nconst requiredFields = [\n  \"lead_quality\",\n  \"budget_estimate\",\n  \"urgency\",\n  \"use_case\",\n  \"decision_maker\",\n  \"score\",\n  \"summary\",\n  \"email\",\n  \"phone\"\n];\n\nfor (const item of items) {\n  const data = item.json;\n\n  // ---------- Required Fields ----------\n  for (const field of requiredFields) {\n    if (\n      data[field] === undefined ||\n      data[field] === null ||\n      (typeof data[field] === \"string\" && data[field].trim() === \"\")\n    ) {\n      throw new Error(`${field} is missing or empty`);\n    }\n  }\n\n  // ---------- Type Checks ----------\n  if (typeof data.email !== \"string\")\n    throw new Error(\"Email must be a string\");\n\n  if (typeof data.score !== \"number\")\n    throw new Error(\"Score must be a number\");\n\n  if (typeof data.budget_estimate !== \"number\")\n    throw new Error(\"Budget must be a number\");\n\n  // ---------- Email Validation ----------\n  if (!emailRegex.test(data.email))\n    throw new Error(\"Invalid email format\");\n\n  // ---------- Phone Validation ----------\n  if (!phoneRegex.test(data.phone))\n    throw new Error(\"Invalid phone format\");\n\n  // ---------- Score Validation ----------\n  if (!Number.isInteger(data.score))\n    throw new Error(\"Score must be an integer\");\n\n  if (data.score < 0 || data.score > 100)\n    throw new Error(\"Score must be between 0 and 100\");\n\n  // ---------- Budget Validation ----------\n  if (!Number.isFinite(data.budget_estimate))\n    throw new Error(\"Budget must be a valid number\");\n\n  if (data.budget_estimate <= 0)\n    throw new Error(\"Budget must be greater than 0\");\n\n  // ---------- Lead Quality Validation ----------\n  const leadQuality = data.lead_quality.trim();\n\n  if (![\"Hot\", \"Warm\", \"Cold\"].includes(leadQuality))\n    throw new Error(\"Invalid lead quality\");\n\n  // ---------- Urgency Validation ----------\n  if (![\"High\", \"Medium\", \"Low\"].includes(data.urgency))\n    throw new Error(\"Invalid urgency value\");\n\n  // ---------- Length Protection ----------\n  if (data.summary.length > 1000)\n    throw new Error(\"Summary too long\");\n\n  if (data.decision_maker.length > 100)\n    throw new Error(\"Decision maker name too long\");\n}\n\n// ‚úÖ If all items pass validation ‚Üí return them unchanged\nreturn items;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -160,
        160
      ],
      "id": "826b5421-d418-43b8-b532-bbe085e1b995",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "fieldToSplitOut": "=Name",
        "include": "allOtherFields",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        592,
        128
      ],
      "id": "931cc81e-0fcc-47fb-ada1-343d3f532354",
      "name": "Split Out"
    },
    {
      "parameters": {
        "mode": "combine",
        "fieldsToMatchString": "=unique_id",
        "joinMode": "keepNonMatches",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        400,
        304
      ],
      "id": "3d0918ae-b70d-41fe-b96e-d29b906a7f70",
      "name": "Merge",
      "alwaysOutputData": true
    }
  ],
  "pinData": {},
  "connections": {
    "Groq Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "DSinRF",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Basic LLM Chain": {
      "main": [
        [
          {
            "node": "DSinRF1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search records": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Send a message",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send a message1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send a message2",
            "type": "main",
            "index": 0
          }
        ],
        [],
        []
      ]
    },
    "Send a message": {
      "main": [
        [
          {
            "node": "Create or update a record",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "combine 4 data",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a message2": {
      "main": [
        [
          {
            "node": "Create or update a record1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a message1": {
      "main": [
        [
          {
            "node": "Create or update a record2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DSinRF": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DSinRF1": {
      "main": [
        [
          {
            "node": "PrSR",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PrSR": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "combine 4 data": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "Search records",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create or update a record": {
      "main": [
        []
      ]
    },
    "Create or update a record2": {
      "main": [
        []
      ]
    },
    "Create or update a record1": {
      "main": [
        []
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "binaryMode": "separate",
    "availableInMCP": false,
    "timeSavedMode": "fixed",
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": "7bh0zHBkZk_2xUiNhX_Yr"
  },
  "versionId": "5c0187ec-4a51-4e68-bb24-c3f11217ee39",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "21052c409508f37ec8694df8a36f37b0c4e41a86cecf36abccb49811ce3fdbea"
  },
  "id": "c2stmXvEVP-SEfFJcCEmT",
  "tags": []
}